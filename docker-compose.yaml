services:
  app:
    # image: jetbrains/teamcity-agent:2025.07.1-linux-sudo
    image: kvtodev/teamcity-agent
    container_name: teamcity-agent
    privileged: true
    network_mode: bridge
    restart: unless-stopped
    volumes:
      - ./config/buildAgent.properties:/data/teamcity_agent/conf/buildAgent.properties
      - ./config/dockerd_env:/etc/default/docker:ro

      - ./cache/docker:/var/lib/docker
    environment:
      - DOCKER_IN_DOCKER=start
      - no_proxy=localhost,127.0.0.1,::1,host.docker.internal,.local
      - NO_PROXY=localhost,127.0.0.1,::1,host.docker.internal,.local
      - http_proxy=http://host.docker.internal:7890
      - https_proxy=http://host.docker.internal:7890
      - HTTP_PROXY=http://host.docker.internal:7890
      - HTTPS_PROXY=http://host.docker.internal:7890
    extra_hosts:
      - "host.docker.internal:host-gateway"
